Upgrading BIGSdb versions
-------------------------
Occasionally a version upgrade may require a small change to the underlying
database structure.  These changes will be noted here and a SQL script to 
perform the change included.

To run the script 'script.sql' against database 'dbase', as the postgres user
type:

psql -f script.sql dbase

Version 1.2
-----------
This introduces the concept of defining an isolate database locus by its
context.  Here we can filter the genome to products of an in silico PCR
reaction or to regions within a defined distance of a matching probe.  Four
new tables are created:

pcr: describes the PCR conditions: primers sequences, allowed priming 
  mismatches and min/max product length
pcr_locus: links loci to any number of PCR reactions.  
probes: describes a nucleotide probe
probe_locus: links loci to a nucleotide probe and describes hybridization 
  thresholds.
Finally a modification of the loci table sets boolean flags to state whether
tag scanning of the locus should be limited only to the seqbin regions 
amplified by the simulated PCR reactions or to within the specified distance
of the probe sequence. 

Script: isolatedb_v1.2.sql

Version 1.3
-----------
There are minor changes to both the isolate and sequence definition database
structures.  

1) The primary key of the isolate database allele_sequences and sequence_flags
tables have been changed to include the stop position.
2) A new table has been added to the sequence definition database - 
'client_dbase_loci_fields' that enables fields within a client isolate database
to be returned following a sequence query, e.g. to identify a species from a
specific allele sequence.

Please run the following upgrade scripts against your databases
isolatedb_v1.3.sql against isolate databases.
seqdefdb_v1.3.sql against sequence definition databases.

Both scripts can be found in the sql/upgrade directory.

Version 1.4
-----------
There are changes to the isolate, sequence definition and jobs database
structures.

1) The loci table of the isolate database has a new field to support flag
tables in seqdef databases.  
2) The sequence bin table of the isolate database has two new fields, run_id
and assembly_id, to support assembly versioning.
3) In both the isolate and seqdef databases the user_permissions table 
has the set_user_permissions field removed as this is no longer used. 
4) The seqdef database has a new allele_flags table to support flagging of
allele sequences.
5) The seqdef database has a new matviews table and Postgres functions
defined to support materialized views of scheme data.
6) The bigsdb_jobs database has a new field called stage added to the jobs
table.  This is to support status messages during a job run.

Please run the following upgrade scripts against your databases
isolatedb_v1.4.sql against isolate databases.
seqdefdb_v1.4.sql against sequence definition databases.
jobs_v1.4.sql against bigsdb_jobs.

All three scripts can be found in the sql/upgrade directory.

Version 1.5
-----------
Changes to the database structures are detailed below:

1) There are new tables in both the isolate and seqdef databases to support
dataset partitions: sets, set_loci, set_schemes. The isolate database has two 
extra tables to handle database views and metadata: set_view and set_metadata.
2) There is a new field in the isolate database loci table, match_longest, 
that when true specifies that a BLAST search for tagging will only return the
best (longest) match.
3) There are two new fields in the loci table of both isolate and seqdef
databases, formatted_name and formatted_common_name, where the isolate name
can be formatted using HTML attributes for display in the website.

Please run the following upgrade scripts against your databases
isolatedb_v1.5.sql against isolate databases.
seqdefdb_v1.5.sql against sequence definition databases.

All three scripts can be found in the sql/upgrade directory.

Version 1.6
-----------
There are changes to the isolate and sequence definition database structures.
Please run the isolatedb_v1.6.sql and seqdefdb_v1.6.sql, found in the sql/
upgrade directory, against your databases.

Please run the following upgrade scripts against your databases
isolatedb_v1.6.sql against isolate databases.
seqdefdb_v1.6.sql against sequence definition databases.

All three scripts can be found in the sql/upgrade directory.




